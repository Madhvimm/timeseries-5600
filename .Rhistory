#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/Spring 2024/Time Series/timeseries-5600/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/Spring 2024/Time Series/timeseries-5600/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
library(ggplot2)
library(readr)
library(tidyverse)
library(lubridate)
library(forecast)
library(tseries)
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
# Load the data
data <- read_csv("county_year_combined.csv",show_col_types = FALSE)
#Normalize the cancer rates
data$normalized_cancer_rate <- (data$`Colorectal Rate per 100,000` - min(data$`Colorectal Rate per 100,000`, na.rm = TRUE)) /
(max(data$`Colorectal Rate per 100,000`, na.rm = TRUE) - min(data$`Colorectal Rate per 100,000`, na.rm = TRUE))
# Normalizing nitrate levels
data$normalized_nitrate <- (data$average_result_value - min(data$average_result_value, na.rm = TRUE)) /
(max(data$average_result_value, na.rm = TRUE) - min(data$average_result_value, na.rm = TRUE))
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
#| output: true
ggplot(data, aes(x = normalized_nitrate, y = normalized_cancer_rate)) +
geom_point(aes(color = county_served), alpha = 0.6) +  # Using alpha for better visibility if points overlap
geom_smooth(method = "lm", se = FALSE, color = "blue") +  # Adding a linear trend line
theme_minimal() +
labs(
title = "Normalized Nitrate Levels vs. Normalized Colorectal Cancer Rates",
x = "Normalized Nitrate Levels",
y = "Normalized Colorectal Cancer Rates"
) +
theme(legend.position = "none")  # Hiding the legend for clarity; remove if county-wise color coding is essential
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/Spring 2024/Time Series/timeseries-5600/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/montly_df.csv")
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("/Users/madhvimalhotra/Downloads/monthly_df.csv")
# Convert year and month to a Date object
monthly_df$date <- with(monthly_df, as.Date(paste(year, month, "01", sep = "-")))
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("monthly_df.csv")
# Convert year and month to a Date object
monthly_df$date <- with(monthly_df, as.Date(paste(year, month, "01", sep = "-")))
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("monthly_df.csv")
# Preprocessing
monthly_df <- monthly_df %>%
filter(pws_id == 'CA1910067') %>%
arrange(year, month) %>%
mutate(date = as.Date(paste(year, month, "01", sep = "-")))
# Convert the data to a time series object for the specific PWS
nitrate_ts <- ts(monthly_df$average_result_value, start = c(min(monthly_df$year), min(monthly_df$month)), frequency = 12)
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("monthly_df.csv")
# Preprocessing
monthly_df <- monthly_df %>%
filter(pws_id == 'CA1910067') %>%
arrange(year, month) %>%
mutate(date = as.Date(paste(year, month, "01", sep = "-")))
# Convert the data to a time series object for the specific PWS
nitrate_ts <- ts(monthly_df$average_result_value, start = c(min(monthly_df$year), min(monthly_df$month)), frequency = 12)
# Time Series Plot
ggplot(monthly_df, aes(x = date, y = average_result_value)) +
geom_line() +
labs(title = "Monthly Nitrate Levels for PWS ID: CA1910067",
x = "Time",
y = "Average Nitrate Level (mg/L)")
# Time Series Plot
p <- ggplot(monthly_df, aes(x = date, y = average_result_value)) +
geom_line() +
labs(title = "Monthly Nitrate Levels for PWS ID: CA1910067",
x = "Time",
y = "Average Nitrate Level (mg/L)")
ggplotly(p)
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
library(ggplot2)
library(readr)
library(tidyverse)
library(lubridate)
library(forecast)
library(tseries)
library(plotly)
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
# Load the data
data <- read_csv("county_year_combined.csv",show_col_types = FALSE)
#Normalize the cancer rates
data$normalized_cancer_rate <- (data$`Colorectal Rate per 100,000` - min(data$`Colorectal Rate per 100,000`, na.rm = TRUE)) /
(max(data$`Colorectal Rate per 100,000`, na.rm = TRUE) - min(data$`Colorectal Rate per 100,000`, na.rm = TRUE))
# Normalizing nitrate levels
data$normalized_nitrate <- (data$average_result_value - min(data$average_result_value, na.rm = TRUE)) /
(max(data$average_result_value, na.rm = TRUE) - min(data$average_result_value, na.rm = TRUE))
#| code-fold: true
#| code-summary: 'Importing Libraries'
#| warning: false
#| output: false
#|
# Read the data
monthly_df <- read_csv("monthly_df.csv")
# Preprocessing
monthly_df <- monthly_df %>%
filter(pws_id == 'CA1910067') %>%
arrange(year, month) %>%
mutate(date = as.Date(paste(year, month, "01", sep = "-")))
# Convert the data to a time series object for the specific PWS
nitrate_ts <- ts(monthly_df$average_result_value, start = c(min(monthly_df$year), min(monthly_df$month)), frequency = 12)
# Time Series Plot
p <- ggplot(monthly_df, aes(x = date, y = average_result_value)) +
geom_line() +
labs(title = "Monthly Nitrate Levels for PWS ID: CA1910067",
x = "Time",
y = "Average Nitrate Level (mg/L)")
ggplotly(p)
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
# Time Series Plot
p <- ggplot(monthly_df, aes(x = date, y = average_result_value)) +
geom_line() +
labs(title = "Average Monthly Nitrate Levels for PWS ID: CA1910067",
x = "Time",
y = "Average Nitrate Level (mg/L)")
ggplotly(p)
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
# Time Series Plot
p <- ggplot(monthly_df, aes(x = date, y = average_result_value)) +
geom_line() +
labs(title = "Average Monthly Nitrate Levels for a single PWS",
x = "Time",
y = "Average Nitrate Level (mg/L)")
ggplotly(p)
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
# Time Series Plot
p <- ggplot(monthly_df, aes(x = date, y = average_result_value)) +
geom_line() +
scale_x_date(date_breaks = "1 year", date_labels = "%Y") +  # Display only years on the x-axis
labs(title = "Monthly Nitrate Levels for PWS ID: CA1910067",
x = "Time",
y = "Average Nitrate Level (mg/L)")
ggplotly(p)
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
#|
# Lag plot
lag_plot <- ggplot(monthly_df, aes(x = lag(average_result_value, 1), y = average_result_value)) +
geom_point(na.rm = TRUE) +
labs(title = "Lag Plot of Nitrate Levels for PWS ID: CA1910067",
x = "Lag 1",
y = "Nitrate Level")
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
#|
# Lag plot
lag_plot <- ggplot(monthly_df, aes(x = lag(average_result_value, 1), y = average_result_value)) +
geom_point(na.rm = TRUE) +
labs(title = "Lag Plot of Nitrate Levels for PWS ID: CA1910067",
x = "Lag 1",
y = "Nitrate Level")
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
#|
# Lag plot
lag_plot <- ggplot(monthly_df, aes(x = lag(average_result_value, 1), y = average_result_value)) +
geom_point(na.rm = TRUE) +
labs(title = "Lag Plot of Nitrate Levels for PWS ID: CA1910067",
x = "Lag 1",
y = "Nitrate Level")
lag_plot
# Apply log transformation to stabilize variance
monthly_df$log_average_result_value <- log(monthly_df$average_result_value + 1) # +1 to avoid log(0)
# Convert the log-transformed data to a time series object
log_nitrate_ts <- ts(monthly_df$log_average_result_value, start = c(min(monthly_df$year), min(monthly_df$month)), frequency = 12)
# Apply log transformation to stabilize variance
monthly_df$log_average_result_value <- log(monthly_df$average_result_value + 1) # +1 to avoid log(0)
# Convert the log-transformed data to a time series object
log_nitrate_ts <- ts(monthly_df$log_average_result_value, start = c(min(monthly_df$year), min(monthly_df$month)), frequency = 12)
# Time Series Plot of the log-transformed data
p_log <- ggplot(monthly_df, aes(x = date, y = log_average_result_value)) +
geom_line() +
scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
labs(title = "Log of Monthly Nitrate Levels for PWS ID: CA1910067",
x = "Time",
y = "Log of Average Nitrate Level (mg/L)")
ggplotly(p_log)
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
#|
# Create the lag plot for log-transformed data
lag_plot_log <- ggplot(monthly_df, aes(x = lag(log_average_result_value, 1), y = log_average_result_value)) +
geom_point(na.rm = TRUE) +
labs(title = "Lag Plot of Log-Transformed Nitrate Levels for PWS ID: CA1910067",
x = "Lag 1 (Log Scale)",
y = "Nitrate Level (Log Scale)")
# Plot the Lag Plot
ggplotly(lag_plot_log)
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
#|
# Create the lag plot for nitrate time series data
lag_plot_nitrate <- gglagplot(nitrate_ts, do.lines = FALSE) +
xlab("Lags") +
ylab("Log-transformed Nitrate Levels") +
ggtitle("Lag Plot for Monthly Nitrate Levels for PWS ID: CA1910067") +
theme_bw()
# Convert to a plotly object for interactivity
ggplotly(lag_plot_nitrate)
#| code-fold: true
#| code-summary: 'Average Nitrate Levels'
#| warning: false
#|
# Decomposition using a multiplicative model
multiplicative_decomp <- decompose(log_nitrate_ts, type = 'multiplicative')
plot(multiplicative_decomp)
